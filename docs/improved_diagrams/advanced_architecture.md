# Advanced Architecture Diagrams

## Main Architecture with Agency and Hybrid Adapters

```
┌────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      SENTINEL-AI ARCHITECTURE                                       │
└────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                │
                                                ▼
┌────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      MODEL ADAPTER LAYER                                            │
│                                                                                                     │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │  GPT-2 Adapter  │  │  BLOOM Adapter  │  │  Llama Adapter  │  │  Other Adapters │                │
│  │                 │  │  (ALiBi)        │  │  (RoPE+SwiGLU)  │  │                 │                │
│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘                │
│           │                    │                    │                    │                          │
│           └────────────────────┼────────────────────┼────────────────────┘                          │
│                                │                    │                                               │
└────────────────────────────────┼────────────────────┼───────────────────────────────────────────────┘
                                 │                    │
                                 ▼                    │
┌────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                                     OUTPUT LAYER                                                    │
│                                                                                                     │
└────────────────────────────────────┬──────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                    ┌─────────────────────────────────────────────────────────────┐                  │
│                    │                TRANSFORMER DECODER BLOCKS                    │◄────┐            │
│                    │   ┌───────────────────────────┐  ┌───────────────────────┐  │     │            │
│                    │   │  Multi-Head Attention     │  │     Feed Forward      │  │     │            │
│                    │   │  with Agency & Gates      │  │       Network         │  │     │            │
│                    │   └───────────────────────────┘  └───────────────────────┘  │     │            │
│                    └───────────────────────┬─────────────────────────────────────┘     │            │
│                                            │                                           │            │
│                                            │       ┌─────────────────────┐            │            │
│                                            │       │                     │            │            │
│                                            └───────►  U-Net Skip Connection ──────────┘            │
│                                                    │                     │                          │
│                                                    └─────────────────────┘                          │
│                                                                                                     │
└─────────────────────────────────────────────────────┬──────────────────────────────────────────────┘
                                                      │
                                                      ▼
┌────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      ENHANCED CONTROLLER                                            │
│                                                                                                     │
│    ┌───────────────────────┐      ┌────────────────────────────┐     ┌─────────────────────────┐   │
│    │                       │      │                            │     │                         │   │
│    │   Metrics Collector   │─────►│  Reinforcement Learning    │────►│   Gate Update Policy    │   │
│    │                       │      │  Controller                │     │                         │   │
│    └───────────────────────┘      └────────────────────────────┘     └─────────────────────────┘   │
│              ▲                                  ▲                                ▲                  │
│              │                                  │                                │                  │
│    ┌─────────┴───────────┐                      │                     ┌──────────┴─────────────┐   │
│    │                     │                      │                     │                        │   │
│    │  - Attention        │                      │                     │  - Pruning Decisions   │   │
│    │    Entropy          │                      │                     │  - Growth Strategy     │   │
│    │  - Gradient Norms   │                      │                     │  - Skip Connection     │   │
│    │  - Utilization      │       ┌──────────────┴────────────┐        │    Management         │   │
│    │  - Performance      │       │                           │        │                        │   │
│    │    Metrics          │       │    Reward Function        │        └────────────────────────┘   │
│    │                     │       │    (Performance Delta)     │                                     │
│    └─────────────────────┘       │                           │                                     │
│                                  └───────────────────────────┘                                     │
│                                                                                                     │
└────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                      │
                                                      ▼
┌────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                                       INPUT EMBEDDING                                               │
│                                                                                                     │
└────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## Attention Head with Agency States

```
┌──────────────────────────────────────────────────────────────────────────────────────────────────┐
│                              ATTENTION HEAD WITH AGENCY                                           │
│                                                                                                   │
│                                                                                                   │
│  ┌────────────────────────────┐        ┌───────────────────────────────────────────────────┐     │
│  │                            │        │                                                   │     │
│  │      AGENCY SIGNALS        │───────►│              STATE PROCESSING                     │     │
│  │                            │        │                                                   │     │
│  │  ┌────────────────────┐    │        │   ┌──────────────┐   ┌──────────────────────┐    │     │
│  │  │ state: active      │    │        │   │              │   │                      │    │     │
│  │  │ consent: true/false│    │        │   │  Withdrawn   │──►│  Skip Computation    │    │     │
│  │  │ utilization: 0.8   │    │        │   │              │   │                      │    │     │
│  │  │ last_signal: t     │    │        │   └──────────────┘   └──────────────────────┘    │     │
│  │  └────────────────────┘    │        │                                                   │     │
│  │                            │        │   ┌──────────────┐   ┌──────────────────────┐    │     │
│  └────────────────────────────┘        │   │              │   │  Reduce Contribution │    │     │
│                                        │   │  Overloaded  │──►│                      │    │     │
│                 ▲                      │   │              │   │  by 50%              │    │     │
│                 │                      │   └──────────────┘   └──────────────────────┘    │     │
│  ┌──────────────┴───────────┐          │                                                   │     │
│  │                          │          │   ┌──────────────┐   ┌──────────────────────┐    │     │
│  │   CONSENT VIOLATION      │          │   │              │   │  Reduce Contribution │    │     │
│  │   MONITORING             │          │   │  Misaligned  │──►│                      │    │     │
│  │                          │          │   │              │   │  by 30%              │    │     │
│  └──────────────────────────┘          │   └──────────────┘   └──────────────────────┘    │     │
│                                        │                                                   │     │
│                                        │   ┌──────────────┐   ┌──────────────────────┐    │     │
│                                        │   │              │   │                      │    │     │
│                                        │   │   Active     │──►│   Full Contribution  │    │     │
│                                        │   │              │   │                      │    │     │
│                                        │   └──────────────┘   └──────────────────────┘    │     │
│                                        │                                                   │     │
│                                        └───────────────────────────────────────────────────┘     │
│                                                              │                                    │
│                                                              ▼                                    │
│  ┌────────────────────────────┐        ┌───────────────────────────────────────────────────┐     │
│  │                            │        │                                                   │     │
│  │      ATTENTION             │◄───────┤              GATE MECHANISM                       │     │
│  │      COMPUTATION           │        │                                                   │     │
│  │                            │        │   output = gate_value * agency_factor * attn_out  │     │
│  └────────────────────────────┘        │                                                   │     │
│                                        └───────────────────────────────────────────────────┘     │
│                                                                                                   │
└───────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## Hybrid Adapter Architecture

```
┌───────────────────────────────────────────────────────────────────────────────────────────────┐
│                                   HYBRID ADAPTER PATTERN                                       │
│                                                                                               │
│                                                                                               │
│                     ┌──────────────────────────────────────────────────┐                      │
│                     │                                                  │                      │
│                     │               SENTINEL-AI INTERFACE              │                      │
│                     │                                                  │                      │
│                     └───────────────────────┬──────────────────────────┘                      │
│                                             │                                                 │
│                                             ▼                                                 │
│                                                                                               │
│  ┌──────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                          │ │
│  │                                 MODEL-SPECIFIC ADAPTER                                   │ │
│  │                                                                                          │ │
│  │  ┌────────────────────────┐   ┌────────────────────────┐   ┌─────────────────────────┐  │ │
│  │  │                        │   │                        │   │                         │  │ │
│  │  │  DUMMY GATE LAYER      │   │ CONTROLLER COMPATIBLE  │   │  AGENCY SIGNAL LAYER    │  │ │
│  │  │                        │   │ INTERFACE              │   │                         │  │ │
│  │  └────────────┬───────────┘   └────────────┬───────────┘   └─────────────┬───────────┘  │ │
│  │               │                            │                             │              │ │
│  │               └────────────────────────────┼─────────────────────────────┘              │ │
│  │                                            │                                            │ │
│  └─────────────────────────────────┬──────────┴────────────────────────────────────────────┘ │
│                                    │                                                          │
│                                    ▼                                                          │
│                                                                                               │
│  ┌──────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                          │ │
│  │                              ORIGINAL MODEL INTERNALS                                    │ │
│  │                                                                                          │ │
│  │   ┌─────────────────────────────────────────┐    ┌────────────────────────────────┐     │ │
│  │   │                                         │    │                                │     │ │
│  │   │  BLOOM: ALiBi Attention                 │    │ LLAMA: Rotary Embeddings      │     │ │
│  │   │                                         │    │ + SwiGLU Activation           │     │ │
│  │   └─────────────────────────────────────────┘    └────────────────────────────────┘     │ │
│  │                                                                                          │ │
│  │                                                                                          │ │
│  └──────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                               │
└───────────────────────────────────────────────────────────────────────────────────────────────┘
```

## Enhanced Controller with Feedback System

```
┌──────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                REINFORCEMENT LEARNING CONTROLLER                                  │
│                                                                                                  │
│                                                                                                  │
│  ┌─────────────────────────────┐        ┌───────────────────────────────────────────────────┐   │
│  │                             │        │                                                   │   │
│  │    VALIDATION METRICS       │───────►│                REWARD CALCULATION                 │   │
│  │    COLLECTOR                │        │                                                   │   │
│  │                             │        │   reward = perf_improvement + efficiency_factor   │   │
│  └─────────────────────────────┘        │                                                   │   │
│                                         └─────────────────────────┬─────────────────────────┘   │
│                                                                   │                             │
│                                                                   ▼                             │
│                                                                                                 │
│  ┌─────────────────────────────┐        ┌───────────────────────────────────────────────────┐   │
│  │                             │        │                                                   │   │
│  │     POLICY NETWORK          │◄───────┤              ACTION HISTORY                       │   │
│  │                             │        │                                                   │   │
│  │  (Learns pruning patterns)  │        │   - Previous gate adjustments                     │   │
│  │                             │        │   - State transitions                             │   │
│  └──────────────┬──────────────┘        │   - Reward history                                │   │
│                 │                       └───────────────────────────────────────────────────┘   │
│                 │                                                                               │
│                 ▼                                                                               │
│                                                                                                 │
│  ┌─────────────────────────────┐        ┌───────────────────────────────────────────────────┐   │
│  │                             │        │                                                   │   │
│  │    GATE VALUE UPDATE        │────────┤              MULTI-OBJECTIVE                      │   │
│  │    MECHANISM                │        │              OPTIMIZATION                         │   │
│  │                             │        │                                                   │   │
│  └─────────────────────────────┘        │   - Balance efficiency vs. performance            │   │
│                                         │   - Task-specific specialization                  │   │
│                                         │   - Continuous adaptation                         │   │
│                                         │                                                   │   │
│                                         └───────────────────────────────────────────────────┘   │
│                                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## Adaptive Transformer Block

```
┌──────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                   ADAPTIVE TRANSFORMER BLOCK                                      │
│                                                                                                  │
│                                                                                                  │
│  ┌─────────────────────────────┐        ┌───────────────────────────────────────────────────┐   │
│  │                             │        │                                                   │   │
│  │      RESIDUAL CONNECTION    │        │              LAYER NORMALIZATION                  │   │
│  │                             │        │                                                   │   │
│  └────────────────┬────────────┘        └────────────────────────┬──────────────────────────┘   │
│                   │                                              │                              │
│                   └──────────────────────────┬─────────────────┬─┘                              │
│                                             │                 │                                  │
│                                             ▼                 │                                  │
│  ┌────────────────────────────────────────────────────────────┐                                 │
│  │                                                             │                                │
│  │                  MULTI-HEAD ATTENTION                       │                                │
│  │                                                             │                                │
│  │   ┌────────────┐  ┌────────────┐  ┌────────────┐            │                                │
│  │   │  HEAD 1    │  │  HEAD 2    │  │  HEAD N    │            │                                │
│  │   │  + AGENCY  │  │  + AGENCY  │  │  + AGENCY  │            │                                │
│  │   └─────┬──────┘  └─────┬──────┘  └─────┬──────┘            │                                │
│  │         │               │               │                   │                                │
│  │         ▼               ▼               ▼                   │                                │
│  │   ┌────────────┐  ┌────────────┐  ┌────────────┐            │                                │
│  │   │  GATE 1    │  │  GATE 2    │  │  GATE N    │            │                                │
│  │   └─────┬──────┘  └─────┬──────┘  └─────┬──────┘            │                                │
│  │         │               │               │                   │                                │
│  │         └───────────────┼───────────────┘                   │                                │
│  │                         │                                   │                                │
│  └─────────────────────────┼───────────────────────────────────┘                                │
│                            │                                                                    │
│                            │                                                                    │
│                            ▼                                                                    │
│  ┌────────────────────────────────────────────────────────────┐                                 │
│  │                                                             │                                │
│  │                  FEED FORWARD NETWORK                       │                                │
│  │                                                             │                                │
│  └─────────────────────────┬───────────────────────────────────┘                                │
│                            │                                                                    │
│                            │                                                                    │
│                            ▼                                                                    │
│  ┌────────────────────────────────────────────────────────────┐                                 │
│  │                                                             │                                │
│  │                       DROPOUT                               │                                │
│  │                                                             │                                │
│  └─────────────────────────┬───────────────────────────────────┘                                │
│                            │                                                                    │
│                            │                ┌────────────────────────────────────┐              │
│                            └───────────────►│                                    │              │
│                                            │    OUTPUT                           │              │
│                                            │                                     │              │
│                                            └────────────────────────────────────┘              │
│                                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## U-Net Skip Connections in Transformer

```
┌───────────────────────────────────────────────────────────────────────────────────────────────┐
│                                 U-NET INSPIRED ARCHITECTURE                                    │
│                                                                                               │
│                     ┌───────────────────────────────────┐                                     │
│                     │        OUTPUT EMBEDDING           │                                     │
│                     └─────────────────┬─────────────────┘                                     │
│                                       │                                                       │
│                                       ▼                                                       │
│ ┌─────────────────────────────────────────────────────────────────────────────────────────┐   │
│ │                                                                                         │   │
│ │                                  DECODER BLOCKS                                         │   │
│ │                                                                                         │   │
│ │    ┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐         │   │
│ │    │   Block N   │     │  Block N-1  │     │  Block N-2  │     │  Block N-3  │         │   │
│ │    │             │     │             │     │             │     │             │         │   │
│ │    └──────┬──────┘     └──────┬──────┘     └──────┬──────┘     └──────┬──────┘         │   │
│ │           │                   │                   │                   │                 │   │
│ │           │                   │                   │                   │                 │   │
│ └───────────┼───────────────────┼───────────────────┼───────────────────┼─────────────────┘   │
│             │                   │                   │                   │                     │
│             │                   │                   │                   │                     │
│ ┌───────────▼───────────────────▼───────────────────▼───────────────────▼─────────────────┐   │
│ │                                                                                         │   │
│ │                                U-NET SKIP CONNECTIONS                                   │   │
│ │                                                                                         │   │
│ │    ┌─────────────────────┐    ┌─────────────────────┐    ┌─────────────────────┐        │   │
│ │    │                     │    │                     │    │                     │        │   │
│ │    │  Fusion Function 1  │    │  Fusion Function 2  │    │  Fusion Function 3  │        │   │
│ │    │                     │    │                     │    │                     │        │   │
│ │    │  Linear([E;D])      │    │  Linear([E;D])      │    │  Linear([E;D])      │        │   │
│ │    │                     │    │                     │    │                     │        │   │
│ │    └─────────────────────┘    └─────────────────────┘    └─────────────────────┘        │   │
│ │              ▲                         ▲                          ▲                     │   │
│ │              │                         │                          │                     │   │
│ └──────────────┼─────────────────────────┼──────────────────────────┼─────────────────────┘   │
│                │                         │                          │                         │
│                │                         │                          │                         │
│ ┌──────────────┼─────────────────────────┼──────────────────────────┼─────────────────────┐   │
│ │                                                                                         │   │
│ │                                  ENCODER BLOCKS                                         │   │
│ │                                                                                         │   │
│ │    ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                             │   │
│ │    │   Block 1   │     │   Block 2   │     │   Block 3   │                             │   │
│ │    │             │     │             │     │             │                             │   │
│ │    └──────┬──────┘     └──────┬──────┘     └──────┬──────┘                             │   │
│ │           │                   │                   │                                     │   │
│ │           │                   │                   │                                     │   │
│ └───────────┼───────────────────┼───────────────────┼─────────────────────────────────────┘   │
│             │                   │                   │                                         │
│             └───────────────────┼───────────────────┘                                         │
│                                 │                                                             │
│                                 ▼                                                             │
│                     ┌───────────────────────────────────┐                                     │
│                     │        INPUT EMBEDDING            │                                     │
│                     └───────────────────────────────────┘                                     │
│                                                                                               │
└───────────────────────────────────────────────────────────────────────────────────────────────┘
```